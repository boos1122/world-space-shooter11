# World Space Shooter

ä¸€ä¸ªåŸºäº Next.js 14 + Phaser 3 çš„ 2D å¤ªç©ºå°„å‡»æ¸¸æˆï¼Œé›†æˆäº† World App MiniKit ç™»å½•éªŒè¯å’Œ Supabase åç«¯ã€‚

## ğŸ® æ¸¸æˆç‰¹æ€§

- **2D å¤ªç©ºå°„å‡»**ï¼šç»å…¸çš„é£æœºå°„å‡»ç©æ³•
- **World ID ç™»å½•**ï¼šé€šè¿‡ World App MiniKit è¿›è¡Œèº«ä»½éªŒè¯
- **æ’è¡Œæ¦œç³»ç»Ÿ**ï¼šå…¨çƒç©å®¶åˆ†æ•°æ’è¡Œ
- **è™šæ‹Ÿé“å…·å•†åº—**ï¼šä½¿ç”¨è™šæ‹Ÿé‡‘å¸è´­ä¹°æ¸¸æˆé“å…·
- **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡

## ğŸ›  æŠ€æœ¯æ ˆ

- **å‰ç«¯**: Next.js 14 (App Router) + TypeScript + Tailwind CSS
- **æ¸¸æˆå¼•æ“**: Phaser 3
- **åç«¯**: Supabase (PostgreSQL + RLS + Edge Functions)
- **è®¤è¯**: World App MiniKit
- **éƒ¨ç½²**: Vercel + Supabase

## ğŸ“ é¡¹ç›®ç»“æ„

```
world-space-shooter/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ api/               # API è·¯ç”±
â”‚   â”œâ”€â”€ layout.tsx         # æ ¹å¸ƒå±€
â”‚   â””â”€â”€ page.tsx           # ä¸»é¡µé¢
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ game/              # Phaser æ¸¸æˆä»£ç 
â”‚   â”‚   â”œâ”€â”€ scenes/        # æ¸¸æˆåœºæ™¯
â”‚   â”‚   â”œâ”€â”€ systems/       # æ¸¸æˆç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ services/      # API æœåŠ¡
â”‚   â”œâ”€â”€ components/        # React ç»„ä»¶
â”‚   â””â”€â”€ lib/               # å·¥å…·åº“
â”œâ”€â”€ public/assets/         # æ¸¸æˆèµ„æº
â”œâ”€â”€ supabase/             # æ•°æ®åº“å’Œ Edge Functions
â””â”€â”€ scripts/              # è„šæœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡

1. **Node.js**: ç‰ˆæœ¬ 18 æˆ–æ›´é«˜
2. **Supabase é¡¹ç›®**: éœ€è¦åˆ›å»º Supabase é¡¹ç›®
3. **World App å¼€å‘è€…è´¦å·**: éœ€è¦æ³¨å†Œ Worldcoin å¼€å‘è€…è´¦å·

### æœ¬åœ°å¼€å‘

1. **å…‹éš†ä»“åº“**
   ```bash
   git clone <your-repo-url>
   cd world-space-shooter
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   npm install
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   cp .env.example .env.local
   ```
   
   å¡«å…¥ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
   - `NEXT_PUBLIC_SUPABASE_URL`: ä½ çš„ Supabase é¡¹ç›® URL
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`: Supabase anon key
   - `SUPABASE_SERVICE_KEY`: Supabase service key (ä»…åç«¯ä½¿ç”¨)
   - `NEXT_PUBLIC_MINIKIT_APP_ID`: World App MiniKit åº”ç”¨ ID
   - `MINIKIT_API_KEY`: MiniKit API å¯†é’¥ (ä»…åç«¯ä½¿ç”¨)

4. **è®¾ç½®æ•°æ®åº“**
   
   åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼š
   ```sql
   -- æ‰§è¡Œ supabase/schema.sql åˆ›å»ºè¡¨ç»“æ„
   -- æ‰§è¡Œ supabase/policies.sql è®¾ç½®å®‰å…¨ç­–ç•¥
   -- (å¯é€‰) æ‰§è¡Œ scripts/seed.sql æ’å…¥æµ‹è¯•æ•°æ®
   ```

5. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
   ```bash
   npm run dev
   ```
   
   è®¿é—® http://localhost:3000

## ğŸ—„ï¸ æ•°æ®åº“æ¶æ„

### æ ¸å¿ƒè¡¨ç»“æ„

| è¡¨å | æè¿° | å…³é”®å­—æ®µ |
|------|------|----------|
| `users` | ç”¨æˆ·ä¿¡æ¯ | `world_id`, `virtual_coins`, `total_score` |
| `scores` | æ¸¸æˆåˆ†æ•°è®°å½• | `user_id`, `score`, `created_at` |
| `items` | è™šæ‹Ÿé“å…· | `id`, `title`, `price_coins` |
| `purchases` | è´­ä¹°è®°å½• | `user_id`, `item_id`, `idempotency_key` |
| `idempotency_records` | å¹‚ç­‰æ€§è®°å½• | `idempotency_key`, `expires_at` |

### å®‰å…¨ç­–ç•¥

- **Row Level Security (RLS)**: æ‰€æœ‰è¡¨éƒ½å¯ç”¨äº† RLS
- **ç”¨æˆ·æ•°æ®éš”ç¦»**: ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **åç«¯å†™å…¥**: åˆ†æ•°å’Œè´­ä¹°è®°å½•åªèƒ½é€šè¿‡ Edge Functions å†™å…¥
- **å¹‚ç­‰æ€§ä¿è¯**: æ‰€æœ‰æ¶‰åŠé‡‘å¸å˜åŠ¨çš„æ“ä½œéƒ½æœ‰å¹‚ç­‰æ€§ä¿æŠ¤

## ğŸ”§ API æ¥å£

### å‰ç«¯ API è·¯ç”±

- `POST /api/session` - World ID ç™»å½•éªŒè¯
- `GET /api/leaderboard` - è·å–æ’è¡Œæ¦œ
- `POST /api/score` - æäº¤æ¸¸æˆåˆ†æ•°
- `POST /api/purchase` - è´­ä¹°è™šæ‹Ÿé“å…·
- `GET /api/health` - å¥åº·æ£€æŸ¥

### Supabase Edge Functions

- `update_score` - å¹‚ç­‰åˆ†æ•°æ›´æ–°
- `purchase_item` - å¹‚ç­‰é“å…·è´­ä¹°
- `get_leaderboard` - æ’è¡Œæ¦œæŸ¥è¯¢

## ğŸ¯ æ¸¸æˆç©æ³•

1. **ç§»åŠ¨**: ä½¿ç”¨é¼ æ ‡/è§¦æ‘¸æˆ– WASD/æ–¹å‘é”®æ§åˆ¶é£èˆ¹
2. **å°„å‡»**: ç‚¹å‡»å±å¹•æˆ–æŒ‰ç©ºæ ¼é”®å°„å‡»
3. **å¾—åˆ†**: å‡»ä¸­æ•Œäººè·å¾—åˆ†æ•°
4. **ç”Ÿå‘½**: è¢«æ•Œäººæ’å‡»æˆ–æ•Œäººé€ƒè„±ä¼šå¤±å»ç”Ÿå‘½
5. **æ’è¡Œæ¦œ**: æ¸¸æˆç»“æŸååˆ†æ•°ä¼šæäº¤åˆ°å…¨çƒæ’è¡Œæ¦œ

## ğŸ›¡ï¸ å®‰å…¨ä¸åˆè§„

### ä¸‰å¤§å®‰å…¨åŸåˆ™

1. **ç¦æ­¢æäº¤å¯†é’¥**: æ‰€æœ‰æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†
2. **ä»…é™è™šæ‹Ÿé“å…·**: ä¸æ¶‰åŠç°å®è´§å¸äº¤æ˜“ã€èµŒåšæˆ–æç°
3. **åç«¯å¹‚ç­‰è®°è´¦**: æ‰€æœ‰ä½™é¢å˜åŠ¨åœ¨åç«¯å¤„ç†ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### æ•°æ®ä¿æŠ¤

- æ‰€æœ‰ API è°ƒç”¨éƒ½æœ‰è¾“å…¥éªŒè¯
- ä½¿ç”¨ JWT è¿›è¡Œç”¨æˆ·è®¤è¯
- æ•°æ®åº“æ“ä½œé€šè¿‡ RLS ç­–ç•¥ä¿æŠ¤
- å¹‚ç­‰æ€§æœºåˆ¶é˜²æ­¢é‡å¤æ“ä½œ

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Vercel éƒ¨ç½² (æ¨è)

1. **è¿æ¥ GitHub**: å°†ä»“åº“è¿æ¥åˆ° Vercel
2. **é…ç½®ç¯å¢ƒå˜é‡**: åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ æ‰€æœ‰ç¯å¢ƒå˜é‡
3. **è‡ªåŠ¨éƒ¨ç½²**: æ¨é€ä»£ç åè‡ªåŠ¨éƒ¨ç½²

### Supabase Edge Functions éƒ¨ç½²

1. **å®‰è£… Supabase CLI**
   ```bash
   npm install -g supabase
   ```

2. **ç™»å½•å¹¶é“¾æ¥é¡¹ç›®**
   ```bash
   supabase login
   supabase link --project-ref <your-project-id>
   ```

3. **éƒ¨ç½² Edge Functions**
   ```bash
   supabase functions deploy update_score
   supabase functions deploy purchase_item
   supabase functions deploy get_leaderboard
   ```

## ğŸ§ª æµ‹è¯•

### æœ¬åœ°æµ‹è¯•

```bash
# è¿è¡Œå¼€å‘æœåŠ¡å™¨
npm run dev

# æ£€æŸ¥ç±»å‹
npm run lint
```

### ç«¯åˆ°ç«¯æµ‹è¯•æµç¨‹

1. å¯åŠ¨æ¸¸æˆ âœ…
2. ç©ä¸€å±€æ¸¸æˆ âœ…  
3. åˆ†æ•°æäº¤åˆ°æ•°æ®åº“ âœ…
4. æ’è¡Œæ¦œæ˜¾ç¤ºæ›´æ–° âœ…
5. (TODO) World ID ç™»å½• ğŸ”„
6. (TODO) è™šæ‹Ÿé“å…·è´­ä¹° ğŸ”„

## ğŸ“‹ å¼€å‘å¾…åŠ

### M1 é‡Œç¨‹ç¢‘ (åŸºç¡€å¯ç©ç‰ˆæœ¬)
- [x] Next.js + Phaser 3 é›†æˆ
- [x] åŸºç¡€æ¸¸æˆç©æ³•
- [x] åˆ†æ•°æäº¤å’Œæ’è¡Œæ¦œ
- [x] æ•°æ®åº“æ¶æ„å’Œå®‰å…¨ç­–ç•¥
- [ ] æ¸¸æˆç´ ææ›¿æ¢

### M2 é‡Œç¨‹ç¢‘ (å®Œæ•´åŠŸèƒ½)
- [ ] World ID ç™»å½•é›†æˆ
- [ ] è™šæ‹Ÿé“å…·è´­ä¹°ç³»ç»Ÿ
- [ ] ç”¨æˆ·ç•Œé¢ä¼˜åŒ–
- [ ] éŸ³æ•ˆå’Œè§†è§‰æ•ˆæœ

### M3 é‡Œç¨‹ç¢‘ (ç”Ÿäº§å°±ç»ª)
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å’Œç›‘æ§
- [ ] å®Œæ•´æµ‹è¯•è¦†ç›–
- [ ] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ†˜ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼š

1. æŸ¥çœ‹ [Issues](../../issues) é¡µé¢
2. åˆ›å»ºæ–°çš„ Issue æè¿°é—®é¢˜
3. è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œä»…ç”¨äºå­¦ä¹ å’Œå¼€å‘ç›®çš„ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·ç¡®ä¿å®Œæˆæ‰€æœ‰å®‰å…¨å®¡æŸ¥å’Œæµ‹è¯•ã€‚
